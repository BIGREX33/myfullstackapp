<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MentorAI | Sign Up</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="signup.css">
    <link rel="shortcut icon" href="mentor-ai-icon.png" type="image/x-icon">
</head>
<body>

<main>
    <div class="signup-container">
        <h2>Join MentorAI</h2>
        <h5>Create your account and start your journey to success</h5>

        <form id="signup-form">
            <div class="form-group">
                <input type="text" id="username" name="username" required placeholder="Username">
                <span id="usernameError" class="error-message"></span>
            </div>

            <div class="form-group">
                <input type="email" id="email" name="email" required placeholder="Email">
                <span id="emailError" class="error-message"></span>
            </div>

            <div class="form-group">
                <div class="input-icon-wrapper">
                    <input type="password" id="password" name="password" required placeholder="Password">
                    <i class="fa-solid fa-eye-slash toggle-password" id="togglePassword"></i>
                </div>
                <span id="passwordError" class="error-message"></span>
            </div>

            <div class="form-group">
                <div class="input-icon-wrapper">
                    <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="Confirm Password">
                    <i class="fa-solid fa-eye-slash toggle-password" id="toggleConfirmPassword"></i>
                </div>
                <span id="confirmPasswordError" class="error-message"></span>
            </div>

            <div class="form-group terms-checkbox">
                <input type="checkbox" id="terms" name="terms" required>
                <label for="terms">I agree to the <a href="terms.html">Terms of Service</a> and <a href="privacy.html">Privacy Policy</a></label>
                <span id="termsError" class="error-message"></span>
            </div>

            <button class="signup-btn" type="submit">Create Account</button>
        </form>

        <div class="divider"><span>or</span></div>

        <div class="social-signup">
            <button class="google-login" aria-label="Sign up with Google">
                <i class="fab fa-google googleicon"></i>
                Continue with Google
            </button>
        </div>

        <div class="login-link">
            <p>Already have an account? <a href="login.html">Log In</a></p>
        </div>
    </div>
</main>

<script>
    // Password toggle logic
    const togglePassword = document.getElementById('togglePassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');

    togglePassword.addEventListener('click', () => {
        const type = password.type === 'password' ? 'text' : 'password';
        password.type = type;
        togglePassword.classList.toggle('fa-eye');
        togglePassword.classList.toggle('fa-eye-slash');
    });

    toggleConfirmPassword.addEventListener('click', () => {
        const type = confirmPassword.type === 'password' ? 'text' : 'password';
        confirmPassword.type = type;
        toggleConfirmPassword.classList.toggle('fa-eye');
        toggleConfirmPassword.classList.toggle('fa-eye-slash');
    });

    // Form validation and submission
    document.getElementById('signup-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const passwordVal = document.getElementById('password').value;
        const confirmPasswordVal = document.getElementById('confirmPassword').value;
        const terms = document.getElementById('terms').checked;

        const usernameError = document.getElementById('usernameError');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');
        const confirmPasswordError = document.getElementById('confirmPasswordError');
        const termsError = document.getElementById('termsError');

        // Clear all errors
        usernameError.textContent = '';
        emailError.textContent = '';
        passwordError.textContent = '';
        confirmPasswordError.textContent = '';
        termsError.textContent = '';

        let isValid = true;

        if (username.length < 3) {
            usernameError.textContent = 'Username must be at least 3 characters.';
            isValid = false;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            emailError.textContent = 'Enter a valid email address.';
            isValid = false;
        }

        const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
        if (!passwordRegex.test(passwordVal)) {
            passwordError.textContent = 'Password must be 8+ characters, include a number, letter, and special character.';
            isValid = false;
        }

        if (passwordVal !== confirmPasswordVal) {
            confirmPasswordError.textContent = 'Passwords do not match.';
            isValid = false;
        }

        if (!terms) {
            termsError.textContent = 'You must agree to the terms.';
            isValid = false;
        }

        if (!isValid) return;

        try {
            const response = await fetch('/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, email, password: passwordVal })
            });

            const data = await response.json();

            if (response.ok) {
                window.location.href = "login.html";
            } else {
                if (data.message) {
                    if (data.message.toLowerCase().includes('username')) {
                        usernameError.textContent = data.message;
                    } else if (data.message.toLowerCase().includes('email')) {
                        emailError.textContent = data.message;
                    } else if (data.message.toLowerCase().includes('password')) {
                        passwordError.textContent = data.message;
                    } else {
                        termsError.textContent = data.message;
                    }
                } else {
                    termsError.textContent = 'Something went wrong. Try again later.';
                }
            }
        } catch (error) {
            termsError.textContent = 'Network error or server not reachable.';
        }
    });
</script>

</body>
</html>
